<div class="untitled-page root" *ngIf="reviews">
    <div class="wrapper">
    <section class="box">
        <div style="text-align: center; height: 20px;">
        <h2>Ratings &amp; Reviews</h2>
        </div>
        <hr>
        <div class="wrapper2">
        <h3 class="highlights">Summary</h3>
        <div class="wrapper3" style="width: ...; margin: 0 auto;">
            <div class="cell">
            <div class="wrapper4">
                <ng-container *ngFor="let ratingStat of ratingStats.slice().reverse(); let ratingVal=index">
                    <div class="wrapper8">
                        <div class="wrapper6">
                            <div class="wrapper61">
                                {{ 5-ratingVal }}
                            </div>
                        </div>
                        <div class="cell" style="padding-left: 5px;">
                            <div fxLayout="row" fxLayoutGap="15px" fxLayoutAlign="start center" fxLayoutW style="margin-right: auto;">
                            <mat-progress-bar [value]="convertToPercent(ratingStat)" style="width: 180px;"></mat-progress-bar>
                            <span class="text" style="font-size: smaller; color: rgb(139, 139, 139);">{{ratingStat}} ({{convertToPercent(ratingStat)}}%)</span>
                            </div>
                        </div>
                    </div>
                 </ng-container>
            </div>
            </div>
            <div class="spacer" style="width: 220px;"></div>
            <div class="cell1">
            <div class="wrapper9">
                <div class="wrapper91">
                <div class="wrapper10">
                    <h2 class="wrapper12" style="padding-bottom: 0; padding-left: 20px; height: 0;">
                        {{ calculateAverageRating() }}
                        <mat-icon style="color: rgb(167, 123, 2);">star</mat-icon>
                    </h2>
                </div>
                <div class="info" style="padding-left: 17px;">{{ reviews.length }} Reviews</div>
                </div>
            </div>
            </div>
        </div>
        </div>
        <div class="wrapper121">
        <div style="text-align: center;">
            <button
                style="width:870px; height: 50px;"
                mat-flat-button color="primary"
                (click)="openDialog()"
            >
                Write a review
            </button>
        </div>
        </div>
    </section>
    <section class="box1">
        <hr size="1" class="line" />
        <div style="text-align: center; margin-top: 20px;">
            <h2>Community Forum</h2>
        </div>
        <div class="box2" *ngFor="let review of reviews">
            <div class="wrapper131">
                <div class="wrapper14" style="padding-top: 5px; padding-bottom: 5px;">
                    <div class="wrapper151"><div class="wrapper152" style="font-size: larger;">{{ review.reviewer }}</div></div>
                    <div class="spacer4" style="width: 20px;"></div>
                    <div class="cell2" style="width:124px;">
                    
                        <ng-container *ngFor="let i of [0, 1, 2, 3, 4]">
                            <mat-icon style="color: rgb(167, 123, 2); display: inline-block;">
                              {{ i < review.rating ? 'star' : 'star_border' }}
                            </mat-icon>
                        </ng-container>
                </div>
                <div class="spacer1" style="width: 560px;"></div>
                <div style="text-align: right; font-size: small;">{{ review.date.toDate() | date: 'mediumDate' }}</div>
                </div>
                <hr size="0" class="line3" align="center" style="padding: 0; margin: 0;"/>
                <p class="wrapper153" style="padding-left: 10px; padding-top: 5px;">
                    {{ review.text }}
                </p>
                <div class="wrapper16">
                <div class="wrapper17" style="padding-left: 10px">
                    <div class="wrapper154">
                        <ng-container *ngIf="review.likes.includes(username); else notLiked">
                            <button mat-icon-button (click)="onDislike(review.id)">
                                <mat-icon style="color:green; vertical-align: middle; padding: 0px 30px 30px 0px;">thumb_up</mat-icon>
                            </button>{{review.likes.length}}
                        </ng-container>
                        <ng-template #notLiked>
                            <button mat-icon-button (click)="onLike(review.id)">
                                <mat-icon style="color:rgb(87, 87, 87); vertical-align: middle; padding: 0px 30px 30px 0px;">thumb_up</mat-icon>
                            </button>{{review.likes.length}}
                        </ng-template>
                    </div>

                    <div class="wrapper154">
                        <ng-container *ngIf="show.get(review.id) == true; else notShown">
                            <button mat-icon-button (click)="toggleComments(review.id)">
                                <mat-icon style="color:green; vertical-align: middle; padding: 0px 30px 30px 0px;">comment</mat-icon>
                            </button>{{comments.length}}
                        </ng-container>
                        <ng-template #notShown>
                            <button mat-icon-button (click)="toggleComments(review.id)">
                                <mat-icon style="color:rgb(87, 87, 87); vertical-align: middle; padding: 0px 30px 30px 0px;">comment</mat-icon>
                            </button>{{comments.length}}
                        </ng-template>
                    </div>

                </div>
                </div>


                

                <div *ngIf="show.get(review.id) == true">
                    <hr size="5" class="line9" align="center" style="margin: 0; padding: 0; margin-top: 10px;"/>

                    <div class="form-group">
                        <label for="comment">Comment</label>
                        <textarea ngModel name="comment" class="form-control" required></textarea>
                    </div>
                    
                    <button class="btn btn-primary" style="margin-top: 5px;" (click)="addComment(review.id)">Comment</button>
                    
                    <div class="box3" *ngFor="let comment of comments"> 

                        <div class="wrapper14" style="padding-top: 2px; padding-bottom: 2px;">
                            <div class="wrapper151"><div class="wrapper152" style="font-size: larger;">{{ comment.commenter }}</div></div>
                        <div class="spacer6" style="width: 660px;"></div>
                        
                        <div style="text-align: right; font-size: small;">{{ review.date.toDate() | date: 'mediumDate' }}</div>
                        </div>
                        <hr size="0" class="line8" align="center" style="margin: 0; padding: 0;"/>
                        <p class="wrapper153" style="padding-left: 10px; padding-top: 5px; padding-bottom: 5px;">
                            {{ comment.text }}
                        </p>
                    </div>
                </div>


                
            </div>
        </div>
    </section>
    </div>
</div>
